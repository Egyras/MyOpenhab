var boolean ChangeInProgress = false
/*
rule "Paradox arm"

when
Item Paradox_Control changed to ARM
then {
Paradox_Control.sendCommand(transform("MAP", "paradox.map", "ARMN"))
}
end

rule "Paradox disarm"

when
Item Paradox_Control changed to DISARM
then {
Paradox_Control.sendCommand(transform("MAP", "paradox.map", "DISARMN"))
}
end
*/


rule "Auto arm and disarm control"
when
    System started
   or 
    Item Paradox_Arm0 changed
   or
    Item Paradox_Arm1 changed 
then

    if( ChangeInProgress ){

        ChangeInProgress = false
    }
    else{

        postUpdate(Auto_Mode,0)
        
    }
end



rule "Auto arm and disarm"
when
    System started
    or
    Item Paradox_Arm0 changed
    or
    Item Paradox_Arm1 changed 
    or
    Time cron "0 0/1 * * * ?"
then
    if( Auto_Mode.state == 1 ){

            var Number hour   = now.getHourOfDay
    		var Number minute = now.getMinuteOfHour

            //var boolean NeedArm = false
            //var boolean NeedDisarm = false
            //if((hour == 21) && (minute == 37) && (Paradox_Arm0.state == "disarmed")) NeedArm = true { logInfo("Paradox.rule","Auto Arm Need") }
            //if((hour == 06) && (minute == 40) && (Paradox_Arm0.state == "armed_away")) NeedDisarm = true { logInfo("Paradox.rule","Auto DisArm Need") }

            if((hour == 21) && (minute == 45) && (Paradox_Arm0.state == "disarmed")){
                Paradox_Arm0.sendCommand("armed_away") { logInfo("Paradox.rule","Auto Arm") }
                ChangeInProgress=true
            }
                             
           if((hour == 06) && (minute == 40) && (Paradox_Arm0.state == "armed_away")){
               Paradox_Arm0.sendCommand("disarmed") { logInfo("Paradox.rule","Auto Disarm") }
               ChangeInProgress=true
            } 
               
    }
end
